var Main=function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function n(){e(this,n)}return t(n,null,[{key:"construct",value:function(){n.rowLength=20,n.columnLength=10,n.hexSize=5,n.cube_directions=[{x:1,y:0,z:-1},{x:1,y:-1,z:-0},{x:0,y:-1,z:1},{x:-1,y:0,z:1},{x:-1,y:1,z:-0},{x:0,y:1,z:-1}],n.cube_diagonals=[{x:2,y:-1,z:-1},{x:1,y:1,z:-2},{x:-1,y:2,z:-1},{x:-2,y:1,z:1},{x:-1,y:-1,z:2},{x:1,y:-2,z:1}]}},{key:"cube_to_id",value:function(e){return this.oddr_to_id(this.cube_to_oddr(e))}},{key:"cube_to_oddr",value:function(e){return{x:e.x+(e.z-(1&e.z))/2,y:e.z}}},{key:"oddr_to_id",value:function(e){return e.y*n.columnLength+e.x}},{key:"oddr_to_cube",value:function(e){var t=e.x-(e.y-(1&e.y))/2,n=e.y;return{x:t,y:-t-n,z:n}}},{key:"id_to_cube",value:function(e){return this.oddr_to_cube(this.id_to_oddr(e))}},{key:"id_to_oddr",value:function(e){var t=Math.floor(e/n.columnLength);return{x:e%n.columnLength,y:t}}},{key:"cube_neighbor",value:function(e,t){return this.cube_add(e,this.cube_directions[t])}},{key:"cube_diagonal_neighbor",value:function(e,t){return this.cube_add(e,this.cube_diagonals[t])}},{key:"cube_distance",value:function(e,t){return(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)+Math.abs(e.z-t.z))/2}},{key:"cube_range",value:function(e,t){for(var n,r,o=[],h=-t;h<=t;h++)for(var i=Math.max(-t,-h-t);i<=Math.min(+t,-h+t);i++)r=-h-i,n=this.cube_add(e,{x:h,y:i,z:r}),this.out_of_bouds(n)||o.push(n);return o}},{key:"intersecting_ranges",value:function(e,t){for(var n=[],r=0;r<e.length;r++)for(var o=e[r],h=0;h<t.length;h++){var i=t[h];o.x==i.x&&o.y==i.y&&o.z==i.z&&n.push(i)}return n}},{key:"cube_linedraw",value:function(e,t){for(var n=this.cube_distance(e,t),r=[],o=0;o<n;o++)r.push(this.cube_round(this.cube_lerp(e,t,1/n*o)));return r}},{key:"lerp",value:function(e,t,n){return e+(t-e)*n}},{key:"cube_lerp",value:function(e,t,n){return{x:this.lerp(e.x,t.x,n),y:this.lerp(e.y,t.y,n),z:this.lerp(e.z,t.z,n)}}},{key:"cube_round",value:function(e){var t=Math.round(e.x),n=Math.round(e.y),r=Math.round(e.z),o=Math.abs(t-e.x),h=Math.abs(n-e.y),i=Math.abs(r-e.z);return o>h&&o>i?t=-n-r:h>i?n=-t-r:r=-t-n,{x:t,y:n,z:r}}},{key:"out_of_bouds",value:function(e){var t=this.cube_to_oddr(e);return t.x<0||t.x>=n.columnLength||(t.y<0||t.y>=n.rowLength)}},{key:"cube_add",value:function(e,t){var n={x:0,y:0,z:0};return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n}}]),n}(),r=function(){function r(t,n,o,h){e(this,r),this.x=t,this.y=n,this.hexId=o,this.accessible=h,this.material,this.mesh}return t(r,[{key:"Accessible",value:function(){return this.accessible}},{key:"getCubeCoords",value:function(){return n.oddr_to_cube({x:this.x,y:this.y})}},{key:"createHexMesh",value:function(e){this.accessible?this.material=new THREE.MeshPhongMaterial({color:5036874,wireframe:!1}):this.material=new THREE.MeshPhongMaterial({color:16777215,wireframe:!1}),this.mesh=new THREE.Mesh(e,this.material),this.mesh.rotation.x=Math.PI/180*90}},{key:"addHexMesh",value:function(e){var t=this.getPosition(n.hexSize);this.mesh.position.set(t.x,t.y,t.z),e.add(this.mesh),this.mesh.hexId=this.hexId}},{key:"changeColor",value:function(e){this.material.color.setHex(e)}},{key:"originalColor",value:function(){this.accessible?this.material.color.setHex(5036874):this.material.color.setHex(16777215)}},{key:"getPosition",value:function(e){var t=Math.sqrt(3)*e,n=2*e,r=0;return 1&this.y&&(r=t/2),{x:t*this.x+r,y:0,z:n*this.y*3/4}}}]),r}(),o=function(){function o(){e(this,o),this.hexList=[],this.hexMeshGroup=new THREE.Group,this.createHexMap()}return t(o,[{key:"createHexMap",value:function(){for(var e,t=this.shapeToGeometry(this.pathToShape(this.drawHexagonPath(n.hexSize))),o=[],h=0;h<n.columnLength;h++){o=[];for(var i=0;i<n.rowLength;i++){e=i*n.columnLength+h;var a=new r(h,i,e,80!=e&&81!=e&&82!=e&&83!=e&&84!=e&&85!=e&&6!=e&&16!=e&&17!=e&&18!=e&&1!=e&&62!=e&&63!=e&&64!=e&&74!=e&&85!=e&&95!=e&&47!=e&&75!=e&&76!=e&&77!=e&&78!=e&&10!=e&&11!=e&&13!=e&&12!=e&&14!=e&&25!=e&&35!=e&&46!=e);a.createHexMesh(t),a.addHexMesh(this.hexMeshGroup),o.push(a)}this.hexList.push(o)}scene.add(this.hexMeshGroup)}},{key:"getNeighborsOf",value:function(e){for(var t,r=[],o=e.getCubeCoords(),h=0;h<6;h++)t=n.cube_add(o,n.cube_directions[h]),n.out_of_bouds(t)||(e=this.getHexById(n.cube_to_id(t)),r.push(e));return r}},{key:"getReachableOf",value:function(e,t){var r,o,h,i=[];i.push(e);var a=[];a.push([e]);for(var u=1;u<t;u++){a.push([]);for(var s=0;s<a[u-1].length;s++){r=a[u-1][s];for(var c=0;c<6;c++)h=n.cube_neighbor(r.getCubeCoords(),c),n.out_of_bouds(h)||(o=this.getHexById(n.cube_to_id(h))).Accessible()&&(i.push(o),a[u].push(o))}}return i}},{key:"getHexById",value:function(e){try{var t=n.id_to_oddr(e);return this.hexList[t.x][t.y]}catch(e){console.log(e)}}},{key:"drawHexagonPath",value:function(e){for(var t,n,r=[],o=0;o<=6;++o)t=60*o-30,n=Math.PI/180*t,r.push({x:e*Math.cos(n),y:e*Math.sin(n)});return r}},{key:"pathToShape",value:function(e){for(var t=new THREE.Shape,n=0;n<e.length;++n)t.lineTo(e[n].x,e[n].y);return t}},{key:"shapeToGeometry",value:function(e){return new THREE.ExtrudeGeometry(e,{amount:.5,bevelEnabled:!1,steps:1})}},{key:"getHexMeshGroup",value:function(){return this.hexMeshGroup}}]),o}(),h=function(){function n(t){e(this,n),this.hexMap=t,this.nodeChanged=[]}return t(n,[{key:"octile",value:function(e,t){var n=Math.SQRT2-1;return e<t?n*e+t:n*t+e}},{key:"backtrace",value:function(e){for(var t=[e];e.parent;)e=e.parent,t.push(e);return t.reverse()}},{key:"clear",value:function(e){for(var t=0;t<this.nodeChanged.length;t++)this.nodeChanged[t].g=0,this.nodeChanged[t].f=0,this.nodeChanged[t].h=0,this.nodeChanged[t].opened=!1,this.nodeChanged[t].closed=!1,this.nodeChanged[t].parent=null;this.nodeChanged=[]}},{key:"find",value:function(e,t){if(this.clear(),!e.Accessible()||!t.Accessible())return[];var n,r,o,h,i,a,u,s=new Heap(function(e,t){return e.f-t.f}),c=Math.SQRT2;for(s.push(e),e.opened=!0;!s.empty();){if((n=s.pop()).closed=!0,this.nodeChanged.push(n),n.x==t.x&&n.y==t.y)return this.backtrace(n);for(r=this.hexMap.getNeighborsOf(n),o=0;o<r.length;o++)h=r[o],this.nodeChanged.push(h),!h.closed&&h.Accessible()&&(i=h.x,a=h.y,u=n.g+(i-n.x==0||a-n.y==0?1:c),(!h.opened||u<h.g)&&(h.g=u,h.h=h.h||1*this.octile(Math.abs(i-t.x),Math.abs(a-t.y)),h.f=h.g+h.h,h.parent=n,h.opened?s.updateItem(h):(s.push(h),h.opened=!0)))}return[]}}]),n}();return function(){function r(){e(this,r),alert("test"),n.construct(),this.helpers(),this.hexMap=new o,this.pathFinder=new h(this.hexMap),this.marked=[]}return t(r,[{key:"helpers",value:function(){var e=new THREE.GridHelper(100,10);scene.add(e);var t=new THREE.AxesHelper(100);scene.add(t)}},{key:"unMarkAll",value:function(){for(var e=0;e<this.marked.length;e++)this.marked[e].originalColor();this.marked=[]}},{key:"buttonClick",value:function(){console.log("click")}},{key:"mouseHexIntersection",value:function(e){var t=e.intersectObjects(this.hexMap.getHexMeshGroup().children);if(t.length>0){var r=document.getElementById("dropdown"),o=r.options[r.selectedIndex].text;this.unMarkAll();var h=this.hexMap.getHexById(5),i=this.hexMap.getHexById(t[0].object.hexId);if("pathfinding"==o)for(var a=this.pathFinder.find(h,i),u=0;u<a.length;u++)a[u].changeColor(255),this.marked.push(a[u]);if("neighbors"==o){var s=this.hexMap.getNeighborsOf(i);for(u=0;u<s.length;u++)s[u].changeColor(16715775),this.marked.push(s[u])}if("reach"==o){var c=this.hexMap.getReachableOf(i,5);for(u=0;u<c.length;u++)c[u].changeColor(16715775),this.marked.push(c[u])}if("linedraw"==o){var d=n.cube_linedraw(h.getCubeCoords(),i.getCubeCoords());for(u=0;u<d.length;u++){(x=this.hexMap.getHexById(n.cube_to_id(d[u]))).changeColor(16715775),this.marked.push(x)}}if("intersect"==o){var l=n.cube_range(i.getCubeCoords(),1);for(u=0;u<l.length;u++){(x=this.hexMap.getHexById(n.cube_to_id(l[u]))).changeColor(16715775),this.marked.push(x)}var f=n.cube_range(h.getCubeCoords(),3);for(u=0;u<f.length;u++){(x=this.hexMap.getHexById(n.cube_to_id(f[u]))).changeColor(16715775),this.marked.push(x)}var y=n.intersecting_ranges(l,f);for(u=0;u<y.length;u++){(x=this.hexMap.getHexById(n.cube_to_id(y[u]))).changeColor(16711680),this.marked.push(x)}}var x=this.hexMap.getHexById(t[0].object.hexId);"intersect"!=o&&(x.changeColor(16715775),this.marked.push(x)),document.getElementById("tileId").innerText=x.x+" - "+x.y+" id: "+x.hexId}}}]),r}()}();
